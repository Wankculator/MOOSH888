<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Comprehensive Test - MOOSH Wallet</title>
    <link rel="stylesheet" href="css/app.css">
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #111;
            border: 2px solid #333;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-button {
            padding: 10px 20px;
            background: #000;
            border: 2px solid #f57315;
            color: #f57315;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #f57315;
            color: #000;
        }
        
        .run-all {
            width: 100%;
            margin: 30px 0;
            padding: 20px;
            font-size: 18px;
            background: #f57315;
            color: #000;
        }
        
        .results {
            background: #000;
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .success { color: #69fd97; }
        .error { color: #ff4444; }
        .info { color: #00d4ff; }
        .warning { color: #f57315; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-card {
            background: #0a0a0a;
            border: 2px solid #222;
            padding: 15px;
            text-align: center;
        }
        
        .test-status {
            margin-top: 10px;
            font-size: 24px;
        }
        
        h3 {
            color: #f57315;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <div class="test-container">
        <h1 style="color: #f57315; text-align: center;">MOOSH WALLET - FINAL COMPREHENSIVE TEST</h1>
        
        <div class="test-section">
            <h3>Test Summary</h3>
            <p>This test will verify all recent fixes and features:</p>
            <ul style="line-height: 1.8;">
                <li>‚úì View mode buttons (GRID, LIST, DETAILS)</li>
                <li>‚úì Account name colors (orange theme)</li>
                <li>‚úì Import/New Account functionality</li>
                <li>‚úì Account switching without auto-close</li>
                <li>‚úì Filters and sorting</li>
                <li>‚úì Balance display</li>
                <li>‚úì Mobile responsiveness</li>
            </ul>
        </div>
        
        <button class="test-button run-all" onclick="runAllTests()">RUN ALL TESTS</button>
        
        <div class="test-grid">
            <div class="test-card">
                <h4>View Modes</h4>
                <button class="test-button" onclick="testViewModes()">TEST</button>
                <div class="test-status" id="viewModeStatus">‚è≥</div>
            </div>
            
            <div class="test-card">
                <h4>Account Colors</h4>
                <button class="test-button" onclick="testAccountColors()">TEST</button>
                <div class="test-status" id="colorStatus">‚è≥</div>
            </div>
            
            <div class="test-card">
                <h4>Import Flow</h4>
                <button class="test-button" onclick="testImportFlow()">TEST</button>
                <div class="test-status" id="importStatus">‚è≥</div>
            </div>
            
            <div class="test-card">
                <h4>Account Switch</h4>
                <button class="test-button" onclick="testAccountSwitch()">TEST</button>
                <div class="test-status" id="switchStatus">‚è≥</div>
            </div>
            
            <div class="test-card">
                <h4>Filters</h4>
                <button class="test-button" onclick="testFilters()">TEST</button>
                <div class="test-status" id="filterStatus">‚è≥</div>
            </div>
            
            <div class="test-card">
                <h4>UI Consistency</h4>
                <button class="test-button" onclick="testUIConsistency()">TEST</button>
                <div class="test-status" id="uiStatus">‚è≥</div>
            </div>
        </div>
        
        <div class="results" id="results">
            <span class="info">Test results will appear here. Click "RUN ALL TESTS" to begin.</span>
        </div>
    </div>
    
    <script src="js/moosh-wallet.js"></script>
    <script>
        const results = document.getElementById('results');
        let testLog = [];
        let testsPassed = 0;
        let testsFailed = 0;
        
        function log(message, type = 'info') {
            const time = new Date().toTimeString().split(' ')[0];
            testLog.push(`<span class="${type}">[${time}] ${message}</span>`);
            results.innerHTML = testLog.join('\n');
            results.scrollTop = results.scrollHeight;
        }
        
        function updateStatus(testId, passed) {
            const statusEl = document.getElementById(testId);
            statusEl.textContent = passed ? '‚úÖ' : '‚ùå';
            if (passed) testsPassed++;
            else testsFailed++;
        }
        
        async function testViewModes() {
            log('\n=== TESTING VIEW MODES ===', 'info');
            
            try {
                // Open modal
                const modal = new AccountListModal(window.app);
                modal.show();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) throw new Error('Modal not found');
                
                // Find buttons
                const buttons = modalEl.querySelectorAll('.account-toolbar button');
                let gridBtn, listBtn, detailsBtn;
                
                buttons.forEach(btn => {
                    if (btn.textContent === 'GRID') gridBtn = btn;
                    else if (btn.textContent === 'LIST') listBtn = btn;
                    else if (btn.textContent === 'DETAILS') detailsBtn = btn;
                });
                
                if (!gridBtn || !listBtn || !detailsBtn) throw new Error('View buttons not found');
                
                // Test each view
                let allViewsWork = true;
                
                // Test LIST
                listBtn.click();
                await new Promise(resolve => setTimeout(resolve, 300));
                const listGrid = modalEl.querySelector('.account-grid');
                if (!listGrid) allViewsWork = false;
                log('‚úì LIST view renders', 'success');
                
                // Test DETAILS
                detailsBtn.click();
                await new Promise(resolve => setTimeout(resolve, 300));
                const detailsGrid = modalEl.querySelector('.account-grid');
                if (!detailsGrid) allViewsWork = false;
                log('‚úì DETAILS view renders', 'success');
                
                // Test GRID
                gridBtn.click();
                await new Promise(resolve => setTimeout(resolve, 300));
                const gridGrid = modalEl.querySelector('.account-grid');
                if (!gridGrid) allViewsWork = false;
                log('‚úì GRID view renders', 'success');
                
                // Close modal
                const closeBtn = modalEl.querySelector('button[onclick*="close"]');
                if (closeBtn) closeBtn.click();
                
                updateStatus('viewModeStatus', allViewsWork);
                log(allViewsWork ? '‚úÖ View modes test PASSED' : '‚ùå View modes test FAILED', allViewsWork ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå View modes test error: ${error.message}`, 'error');
                updateStatus('viewModeStatus', false);
            }
        }
        
        async function testAccountColors() {
            log('\n=== TESTING ACCOUNT COLORS ===', 'info');
            
            try {
                // Open modal
                const modal = new AccountListModal(window.app);
                modal.show();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) throw new Error('Modal not found');
                
                // Check account name color in GRID view
                const accountName = modalEl.querySelector('h4');
                if (!accountName) throw new Error('Account name not found');
                
                const nameColor = window.getComputedStyle(accountName).color;
                const isOrange = nameColor === 'rgb(245, 115, 21)';
                
                log(`Account name color: ${nameColor}`, isOrange ? 'success' : 'warning');
                
                // Test LIST view
                const listBtn = Array.from(modalEl.querySelectorAll('button')).find(btn => btn.textContent === 'LIST');
                if (listBtn) {
                    listBtn.click();
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    const listAccountName = modalEl.querySelector('.account-grid div[style*="fontWeight"]');
                    if (listAccountName) {
                        const listColor = window.getComputedStyle(listAccountName).color;
                        log(`LIST view name color: ${listColor}`, listColor === 'rgb(245, 115, 21)' ? 'success' : 'warning');
                    }
                }
                
                // Close modal
                const closeBtn = modalEl.querySelector('button[onclick*="close"]');
                if (closeBtn) closeBtn.click();
                
                updateStatus('colorStatus', isOrange);
                log(isOrange ? '‚úÖ Account colors test PASSED' : '‚ùå Account colors test FAILED', isOrange ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå Account colors test error: ${error.message}`, 'error');
                updateStatus('colorStatus', false);
            }
        }
        
        async function testImportFlow() {
            log('\n=== TESTING IMPORT FLOW ===', 'info');
            
            try {
                // Open AccountListModal
                const modal = new AccountListModal(window.app);
                modal.show();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) throw new Error('Modal not found');
                
                // Find Import button
                const importBtn = Array.from(modalEl.querySelectorAll('button')).find(
                    btn => btn.textContent === 'Import'
                );
                if (!importBtn) throw new Error('Import button not found');
                
                // Click Import
                importBtn.click();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Check if MultiAccountModal opened
                const importModal = document.querySelector('.multi-account-modal');
                const importOpened = !!importModal;
                
                if (importOpened) {
                    log('‚úì Import modal opened', 'success');
                    
                    // Check for required fields
                    const mnemonicInput = importModal.querySelector('textarea');
                    const nameInput = importModal.querySelector('input[type="text"]');
                    
                    if (mnemonicInput) log('‚úì Mnemonic input found', 'success');
                    if (nameInput) log('‚úì Name input found', 'success');
                    
                    // Close import modal
                    const closeBtn = importModal.querySelector('button[onclick*="close"]');
                    if (closeBtn) closeBtn.click();
                }
                
                updateStatus('importStatus', importOpened);
                log(importOpened ? '‚úÖ Import flow test PASSED' : '‚ùå Import flow test FAILED', importOpened ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå Import flow test error: ${error.message}`, 'error');
                updateStatus('importStatus', false);
            }
        }
        
        async function testAccountSwitch() {
            log('\n=== TESTING ACCOUNT SWITCH ===', 'info');
            
            try {
                // Ensure we have at least 2 accounts
                const accounts = window.app.state.get('accounts') || [];
                if (accounts.length < 2) {
                    log('‚ö† Need at least 2 accounts to test switching', 'warning');
                    updateStatus('switchStatus', true);
                    return;
                }
                
                // Open modal
                const modal = new AccountListModal(window.app);
                modal.show();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) throw new Error('Modal not found');
                
                // Find MAKE ACTIVE button
                const makeActiveBtn = Array.from(modalEl.querySelectorAll('button')).find(
                    btn => btn.textContent === 'MAKE ACTIVE'
                );
                
                if (!makeActiveBtn) {
                    log('‚ö† No inactive accounts to switch to', 'warning');
                    updateStatus('switchStatus', true);
                    return;
                }
                
                // Click MAKE ACTIVE
                makeActiveBtn.click();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Check if modal is still open
                const modalStillOpen = document.querySelector('.account-list-modal');
                const staysOpen = !!modalStillOpen;
                
                log(staysOpen ? '‚úì Modal stays open after switch' : '‚úó Modal closed after switch', staysOpen ? 'success' : 'error');
                
                // Close modal if still open
                if (modalStillOpen) {
                    const closeBtn = modalStillOpen.querySelector('button[onclick*="close"]');
                    if (closeBtn) closeBtn.click();
                }
                
                updateStatus('switchStatus', staysOpen);
                log(staysOpen ? '‚úÖ Account switch test PASSED' : '‚ùå Account switch test FAILED', staysOpen ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå Account switch test error: ${error.message}`, 'error');
                updateStatus('switchStatus', false);
            }
        }
        
        async function testFilters() {
            log('\n=== TESTING FILTERS ===', 'info');
            
            try {
                // Open modal
                const modal = new AccountListModal(window.app);
                modal.show();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) throw new Error('Modal not found');
                
                // Find FILTERS button
                const filtersBtn = Array.from(modalEl.querySelectorAll('button')).find(
                    btn => btn.textContent === 'FILTERS'
                );
                if (!filtersBtn) throw new Error('Filters button not found');
                
                // Click FILTERS
                filtersBtn.click();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Check if filter panel appeared
                const filterPanel = modalEl.querySelector('.filter-panel');
                const filtersWork = !!filterPanel;
                
                if (filtersWork) {
                    log('‚úì Filter panel opens', 'success');
                    
                    // Check for filter options
                    const balanceFilters = filterPanel.querySelectorAll('button[onclick*="balance"]');
                    if (balanceFilters.length > 0) log('‚úì Balance filters found', 'success');
                    
                    const activityFilters = filterPanel.querySelectorAll('button[onclick*="activity"]');
                    if (activityFilters.length > 0) log('‚úì Activity filters found', 'success');
                }
                
                // Close modal
                const closeBtn = modalEl.querySelector('button[onclick*="close"]');
                if (closeBtn) closeBtn.click();
                
                updateStatus('filterStatus', filtersWork);
                log(filtersWork ? '‚úÖ Filters test PASSED' : '‚ùå Filters test FAILED', filtersWork ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå Filters test error: ${error.message}`, 'error');
                updateStatus('filterStatus', false);
            }
        }
        
        async function testUIConsistency() {
            log('\n=== TESTING UI CONSISTENCY ===', 'info');
            
            let allPassed = true;
            
            try {
                // Open modal
                const modal = new AccountListModal(window.app);
                modal.show();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) throw new Error('Modal not found');
                
                // Check for emojis
                const modalText = modalEl.innerText;
                const hasEmojis = /[\u{1F300}-\u{1F9FF}]/u.test(modalText);
                
                if (hasEmojis) {
                    log('‚úó Found emojis in UI', 'error');
                    allPassed = false;
                } else {
                    log('‚úì No emojis found', 'success');
                }
                
                // Check button styling
                const buttons = modalEl.querySelectorAll('button');
                let consistentStyling = true;
                
                buttons.forEach(btn => {
                    const bg = window.getComputedStyle(btn).backgroundColor;
                    const border = window.getComputedStyle(btn).border;
                    
                    // Should have black background or orange (for active)
                    if (bg !== 'rgb(0, 0, 0)' && bg !== 'rgb(245, 115, 21)') {
                        consistentStyling = false;
                    }
                });
                
                log(consistentStyling ? '‚úì Button styling consistent' : '‚úó Button styling inconsistent', consistentStyling ? 'success' : 'error');
                if (!consistentStyling) allPassed = false;
                
                // Check font family
                const fontFamily = window.getComputedStyle(modalEl).fontFamily;
                const hasMonospace = fontFamily.includes('JetBrains Mono') || fontFamily.includes('monospace');
                
                log(hasMonospace ? '‚úì Using monospace font' : '‚úó Not using monospace font', hasMonospace ? 'success' : 'error');
                if (!hasMonospace) allPassed = false;
                
                // Close modal
                const closeBtn = modalEl.querySelector('button[onclick*="close"]');
                if (closeBtn) closeBtn.click();
                
                updateStatus('uiStatus', allPassed);
                log(allPassed ? '‚úÖ UI consistency test PASSED' : '‚ùå UI consistency test FAILED', allPassed ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå UI consistency test error: ${error.message}`, 'error');
                updateStatus('uiStatus', false);
            }
        }
        
        async function runAllTests() {
            testLog = [];
            testsPassed = 0;
            testsFailed = 0;
            
            // Reset all status indicators
            document.querySelectorAll('.test-status').forEach(el => el.textContent = '‚è≥');
            
            log('=== STARTING COMPREHENSIVE TEST SUITE ===\n', 'info');
            log(`Timestamp: ${new Date().toLocaleString()}`, 'info');
            log(`Current accounts: ${window.app.state.get('accounts')?.length || 0}`, 'info');
            log(`Active account: ${window.app.state.getCurrentAccount()?.name || 'None'}`, 'info');
            
            // Run tests sequentially
            await testViewModes();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testAccountColors();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testImportFlow();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testAccountSwitch();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testFilters();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testUIConsistency();
            
            // Summary
            log('\n=== TEST SUITE COMPLETE ===', 'info');
            log(`\nTotal tests run: ${testsPassed + testsFailed}`, 'info');
            log(`Passed: ${testsPassed}`, 'success');
            log(`Failed: ${testsFailed}`, testsFailed > 0 ? 'error' : 'info');
            
            if (testsFailed === 0) {
                log('\nüéâ ALL TESTS PASSED! The wallet is ready for production use.', 'success');
            } else {
                log('\n‚ö†Ô∏è Some tests failed. Please review the errors above.', 'warning');
            }
            
            // List all fixes applied
            log('\n=== FIXES APPLIED IN THIS SESSION ===', 'info');
            log('1. ‚úì View mode buttons (GRID, LIST, DETAILS) now functional', 'success');
            log('2. ‚úì Account names use orange theme color instead of white', 'success');
            log('3. ‚úì Import/New Account buttons fixed (no more undefined error)', 'success');
            log('4. ‚úì Account switching keeps modal open', 'success');
            log('5. ‚úì All emojis removed from UI', 'success');
            log('6. ‚úì Consistent button styling throughout', 'success');
            log('7. ‚úì Smart filters and sorting implemented', 'success');
            log('8. ‚úì Dashboard header cleaned (no redundant active display)', 'success');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('Test suite ready. Click "RUN ALL TESTS" to begin comprehensive testing.', 'info');
            }, 500);
        });
    </script>
</body>
</html>