<!DOCTYPE html>
<html>
<head>
    <title>Full App Test</title>
    <meta charset="UTF-8">
    <script>
        // Capture all console logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const logs = [];
        
        console.log = function(...args) {
            logs.push({type: 'log', message: args.join(' '), time: new Date()});
            originalLog.apply(console, args);
        };
        console.warn = function(...args) {
            logs.push({type: 'warn', message: args.join(' '), time: new Date()});
            originalWarn.apply(console, args);
        };
        console.error = function(...args) {
            logs.push({type: 'error', message: args.join(' '), time: new Date()});
            originalError.apply(console, args);
        };
    </script>
</head>
<body>
    <h1>Full Application Test</h1>
    <div id="status">Loading scripts...</div>
    <div id="logs" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; max-height: 400px; overflow-y: auto; margin: 20px 0;"></div>
    <div id="results"></div>
    
    <!-- Load all the scripts in order -->
    <script src="/js/api-config.js"></script>
    <script src="/js/debug-console.js"></script>
    <script src="/js/secure-storage.js"></script>
    <script src="/js/loading-system.js"></script>
    <script src="/js/resilient-api.js"></script>
    <script src="/js/frontend-speed-fix.js"></script>
    
    <script>
        function updateLogs() {
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = logs.map(log => {
                const color = log.type === 'error' ? '#f00' : log.type === 'warn' ? '#ff0' : '#0f0';
                return `<div style="color: ${color}">[${log.time.toLocaleTimeString()}] ${log.message}</div>`;
            }).join('');
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        setInterval(updateLogs, 500);
        
        async function runTests() {
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            
            status.textContent = 'Testing configuration...';
            
            // Test 1: Check window.apiConfig
            results.innerHTML += '<h3>API Configuration:</h3>';
            if (window.apiConfig) {
                results.innerHTML += '<pre>' + JSON.stringify(window.apiConfig, null, 2) + '</pre>';
            } else {
                results.innerHTML += '<p style="color: red;">❌ window.apiConfig not found!</p>';
            }
            
            // Test 2: Check resilient API
            results.innerHTML += '<h3>Resilient API:</h3>';
            results.innerHTML += '<p>window.resilientAPI: ' + (window.resilientAPI ? '✓' : '✗') + '</p>';
            results.innerHTML += '<p>window.originalFetch: ' + (window.originalFetch ? '✓' : '✗') + '</p>';
            
            // Test 3: Try actual API calls
            status.textContent = 'Testing API endpoints...';
            results.innerHTML += '<h3>API Endpoint Tests:</h3>';
            
            // Test local API
            try {
                results.innerHTML += '<p>Testing local API...</p>';
                const localUrl = `${window.apiConfig?.baseURL || 'http://localhost:3001'}/api/health`;
                const response = await fetch(localUrl);
                const data = await response.json();
                results.innerHTML += '<p style="color: green;">✓ Local API: ' + JSON.stringify(data) + '</p>';
            } catch (error) {
                results.innerHTML += '<p style="color: red;">✗ Local API Error: ' + error.message + '</p>';
                results.innerHTML += '<pre style="color: red;">' + error.stack + '</pre>';
            }
            
            // Test Bitcoin price
            try {
                results.innerHTML += '<p>Testing Bitcoin price...</p>';
                const response = await fetch(`${window.apiConfig?.baseURL || 'http://localhost:3001'}/api/proxy/bitcoin-price`);
                const data = await response.json();
                results.innerHTML += '<p style="color: green;">✓ Bitcoin price: $' + data.USD + '</p>';
            } catch (error) {
                results.innerHTML += '<p style="color: red;">✗ Bitcoin price Error: ' + error.message + '</p>';
            }
            
            // Test mempool fees
            try {
                results.innerHTML += '<p>Testing mempool fees...</p>';
                const response = await fetch(`${window.apiConfig?.baseURL || 'http://localhost:3001'}/api/proxy/mempool/fees`);
                const data = await response.json();
                results.innerHTML += '<p style="color: green;">✓ Mempool fees: ' + JSON.stringify(data) + '</p>';
            } catch (error) {
                results.innerHTML += '<p style="color: red;">✗ Mempool fees Error: ' + error.message + '</p>';
            }
            
            // Test direct external API
            try {
                results.innerHTML += '<p>Testing direct Blockstream API...</p>';
                const response = await fetch('https://blockstream.info/api/blocks/tip/height');
                const data = await response.text();
                results.innerHTML += '<p style="color: green;">✓ Blockstream height: ' + data + '</p>';
            } catch (error) {
                results.innerHTML += '<p style="color: red;">✗ Blockstream Error: ' + error.message + '</p>';
            }
            
            status.textContent = 'Tests complete. Check results below.';
        }
        
        // Wait for scripts to load
        setTimeout(runTests, 1000);
    </script>
</body>
</html>