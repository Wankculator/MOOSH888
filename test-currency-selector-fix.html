<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOOSH Test - Currency Selector Fix</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #f57315;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            border: 1px solid #f57315;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #111;
            border-left: 3px solid #f57315;
            font-size: 12px;
        }
        
        .status-ok { border-left-color: #00ff00; color: #00ff00; }
        .status-error { border-left-color: #ff0000; color: #ff0000; }
        .status-info { border-left-color: #f57315; color: #f57315; }
        .status-warning { border-left-color: #ffff00; color: #ffff00; }
        
        button {
            background: #000;
            color: #f57315;
            border: 2px solid #f57315;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background: #f57315;
            color: #000;
        }
        
        /* Moosh mode overrides */
        body.moosh-mode {
            color: #69fd97;
        }
        
        body.moosh-mode .test-container,
        body.moosh-mode .test-section {
            border-color: #69fd97;
        }
        
        body.moosh-mode button {
            color: #69fd97;
            border-color: #69fd97;
        }
        
        body.moosh-mode button:hover {
            background: #69fd97;
            color: #000;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-box {
            border: 1px solid #333;
            padding: 20px;
        }
        
        .comparison-box h3 {
            margin-top: 0;
            color: #ff8c42;
        }
        
        body.moosh-mode .comparison-box h3 {
            color: #7fffb3;
        }
        
        .style-info {
            background: #111;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 11px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>[==] CURRENCY SELECTOR FIX TEST [==]</h1>
            <p>Testing Currency Selector UI Match & Theme Awareness</p>
        </div>
        
        <div class="test-section">
            <h2>[>] Test Controls</h2>
            <button onclick="toggleTheme()">Toggle Theme (Original/Moosh)</button>
            <button onclick="openAccountListModal()">Open Account List Modal</button>
            <button onclick="inspectSelector()">Inspect Currency Selector</button>
            <button onclick="checkScrollbar()">Check Scrollbar</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
        
        <div class="test-section">
            <h2>[>] Current Status</h2>
            <div id="theme-status">Theme: Original (Orange)</div>
            <div id="selector-status">Selector: Not opened yet</div>
            <div id="scrollbar-status">Scrollbar: Not checked</div>
        </div>
        
        <div class="comparison-grid">
            <div class="comparison-box">
                <h3>Expected (Dashboard Style)</h3>
                <ul>
                    <li>Background: #000 (pure black)</li>
                    <li>Border: 2px solid (theme color)</li>
                    <li>No grey scrollbar</li>
                    <li>Theme-aware colors:
                        <ul>
                            <li>Original: #f57315 (orange)</li>
                            <li>Moosh: #69fd97 (green)</li>
                        </ul>
                    </li>
                    <li>Hover changes border/text color</li>
                    <li>Dropdown arrow matches theme</li>
                </ul>
            </div>
            
            <div class="comparison-box">
                <h3>Actual (Current State)</h3>
                <div id="actual-state">
                    <p>Open modal to check...</p>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>[>] Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>[>] Applied Styles</h2>
            <div id="style-display"></div>
        </div>
    </div>
    
    <!-- Load MOOSH Wallet -->
    <script src="/public/js/moosh-wallet.js"></script>
    
    <script>
        let app = null;
        let accountListModal = null;
        
        // Initialize the app
        window.addEventListener('DOMContentLoaded', () => {
            try {
                app = new MOOSHWallet();
                // Create a test account
                app.state.set('accounts', [{
                    id: 'test-1',
                    name: 'Test Account',
                    addresses: { bitcoin: 'bc1test...', segwit: '3test...' },
                    createdAt: Date.now()
                }]);
                app.state.set('currentAccountId', 'test-1');
                
                logResult('App initialized', 'ok');
                updateThemeStatus();
            } catch (error) {
                logResult('Failed to initialize: ' + error.message, 'error');
            }
        });
        
        function logResult(message, status = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result status-${status}`;
            const timestamp = new Date().toLocaleTimeString();
            const indicator = status === 'ok' ? '[OK]' : status === 'error' ? '[X]' : status === 'warning' ? '[!!]' : '[>]';
            resultDiv.textContent = `${timestamp} ${indicator} ${message}`;
            resultsDiv.appendChild(resultDiv);
            console.log(`${indicator} ${message}`);
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('actual-state').innerHTML = '<p>Open modal to check...</p>';
            document.getElementById('style-display').innerHTML = '';
            logResult('Results cleared', 'info');
        }
        
        function toggleTheme() {
            const isMooshMode = document.body.classList.contains('moosh-mode');
            if (isMooshMode) {
                document.body.classList.remove('moosh-mode');
                localStorage.setItem('mooshTheme', 'original');
            } else {
                document.body.classList.add('moosh-mode');
                localStorage.setItem('mooshTheme', 'moosh');
            }
            
            updateThemeStatus();
            logResult('Theme toggled', 'ok');
            
            // If modal is open, it should auto-update
            if (accountListModal && accountListModal.modal) {
                logResult('Modal open - styles should auto-refresh', 'info');
                setTimeout(() => inspectSelector(), 500);
            }
        }
        
        function updateThemeStatus() {
            const isMooshMode = document.body.classList.contains('moosh-mode');
            const status = document.getElementById('theme-status');
            status.textContent = `Theme: ${isMooshMode ? 'Moosh (Green)' : 'Original (Orange)'}`;
            status.style.color = isMooshMode ? '#69fd97' : '#f57315';
        }
        
        function openAccountListModal() {
            if (!app) {
                logResult('App not initialized', 'error');
                return;
            }
            
            try {
                accountListModal = new AccountListModal(app);
                accountListModal.show();
                logResult('AccountListModal opened', 'ok');
                
                // Wait for render then inspect
                setTimeout(() => {
                    inspectSelector();
                    checkScrollbar();
                }, 500);
            } catch (error) {
                logResult('Failed to open modal: ' + error.message, 'error');
            }
        }
        
        function inspectSelector() {
            const selector = document.getElementById('currency-selector');
            const styles = document.getElementById('currency-selector-styles');
            
            if (!selector) {
                logResult('Currency selector not found', 'error');
                document.getElementById('selector-status').textContent = 'Selector: Not found';
                return;
            }
            
            logResult('Currency selector found', 'ok');
            
            const computed = window.getComputedStyle(selector);
            const isMooshMode = document.body.classList.contains('moosh-mode');
            const expectedColor = isMooshMode ? 'rgb(105, 253, 151)' : 'rgb(245, 115, 21)';
            
            // Check key properties
            const checks = {
                'Background': computed.backgroundColor === 'rgb(0, 0, 0)',
                'Border Color': computed.borderColor.includes(expectedColor.replace('rgb', '').replace(/[()]/g, '')),
                'Text Color': computed.color.includes(expectedColor.replace('rgb', '').replace(/[()]/g, '')),
                'Scrollbar Hidden': computed.scrollbarWidth === 'none' || computed.msOverflowStyle === 'none',
                'Styles Applied': styles !== null
            };
            
            // Update actual state display
            const actualDiv = document.getElementById('actual-state');
            actualDiv.innerHTML = `
                <ul>
                    <li>Background: ${computed.backgroundColor}</li>
                    <li>Border: ${computed.borderWidth} ${computed.borderStyle} ${computed.borderColor}</li>
                    <li>Color: ${computed.color}</li>
                    <li>Scrollbar: ${computed.scrollbarWidth || 'default'}</li>
                    <li>Theme-aware: ${checks['Border Color'] ? 'YES' : 'NO'}</li>
                </ul>
            `;
            
            // Log results
            let allPassed = true;
            for (const [check, passed] of Object.entries(checks)) {
                logResult(`${check}: ${passed ? 'PASSED' : 'FAILED'}`, passed ? 'ok' : 'error');
                if (!passed) allPassed = false;
            }
            
            document.getElementById('selector-status').textContent = 
                `Selector: ${allPassed ? 'All checks passed' : 'Some checks failed'}`;
            document.getElementById('selector-status').style.color = 
                allPassed ? '#00ff00' : '#ff0000';
            
            // Display applied styles
            if (styles) {
                const styleDisplay = document.getElementById('style-display');
                styleDisplay.innerHTML = '<h4>Applied Styles:</h4>';
                const pre = document.createElement('pre');
                pre.className = 'style-info';
                pre.textContent = styles.textContent.substring(0, 500) + '...';
                styleDisplay.appendChild(pre);
            }
        }
        
        function checkScrollbar() {
            const selector = document.getElementById('currency-selector');
            if (!selector) {
                logResult('Cannot check scrollbar - selector not found', 'error');
                return;
            }
            
            // Check if scrollbar is hidden
            const hasWebkitScrollbar = window.getComputedStyle(selector, '::-webkit-scrollbar').display === 'none';
            const scrollbarWidth = window.getComputedStyle(selector).scrollbarWidth;
            
            const isHidden = hasWebkitScrollbar || scrollbarWidth === 'none';
            
            logResult(`Scrollbar hidden: ${isHidden ? 'YES' : 'NO'}`, isHidden ? 'ok' : 'warning');
            document.getElementById('scrollbar-status').textContent = 
                `Scrollbar: ${isHidden ? 'Hidden correctly' : 'Still visible'}`;
            document.getElementById('scrollbar-status').style.color = 
                isHidden ? '#00ff00' : '#ffff00';
        }
        
        // Initial log
        logResult('Currency selector fix test initialized', 'ok');
    </script>
</body>
</html>