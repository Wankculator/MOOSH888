<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Wallet Import Test</title>
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #0f0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #111;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #ff0; }
        button {
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
        }
        button:hover {
            background: #0f0;
            color: #000;
        }
        pre {
            background: #111;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ðŸ”§ Multi-Wallet Import Test Suite</h1>
    
    <div class="test-section">
        <h2>Test 1: Multi-Wallet Import Enhancement</h2>
        <button onclick="testMultiWalletImport()">Run Test</button>
        <div id="test1-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Private Key Import in Multi-Wallet Mode</h2>
        <button onclick="testPrivateKeyImport()">Run Test</button>
        <div id="test2-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Tab Switching</h2>
        <button onclick="testTabSwitching()">Run Test</button>
        <div id="test3-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: WIF Validation</h2>
        <button onclick="testWIFValidation()">Run Test</button>
        <div id="test4-result" class="test-result"></div>
    </div>
    
    <script>
        function log(testId, message, type = 'info') {
            const resultDiv = document.getElementById(`${testId}-result`);
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toISOString().substr(11, 8)}] ${message}`;
            resultDiv.appendChild(entry);
        }
        
        async function testMultiWalletImport() {
            log('test1', 'Starting multi-wallet import enhancement test...', 'info');
            
            try {
                // Check if enhancement script loaded
                if (window.MultiWalletImportFix) {
                    log('test1', 'âœ“ Multi-wallet import fix script loaded', 'success');
                } else {
                    log('test1', 'âœ— Multi-wallet import fix script not found', 'error');
                }
                
                // Check if AccountListModal exists
                if (window.AccountListModal) {
                    log('test1', 'âœ“ AccountListModal found', 'success');
                    
                    // Check if importAccount method was enhanced
                    const modal = new AccountListModal({ state: { get: () => [] } });
                    if (modal.importAccount) {
                        log('test1', 'âœ“ importAccount method exists', 'success');
                    }
                } else {
                    log('test1', 'âœ— AccountListModal not found', 'error');
                }
                
                // Check if MultiAccountModal enhancements exist
                if (window.MultiAccountModal) {
                    log('test1', 'âœ“ MultiAccountModal found', 'success');
                    
                    const multiModal = new MultiAccountModal({ state: { get: () => [] } });
                    if (multiModal.createSeedImportForm) {
                        log('test1', 'âœ“ createSeedImportForm method added', 'success');
                    }
                    if (multiModal.createPrivateKeyImportForm) {
                        log('test1', 'âœ“ createPrivateKeyImportForm method added', 'success');
                    }
                    if (multiModal.handleImportPrivateKey) {
                        log('test1', 'âœ“ handleImportPrivateKey method added', 'success');
                    }
                } else {
                    log('test1', 'âœ— MultiAccountModal not found', 'error');
                }
                
                log('test1', 'Test completed!', 'success');
            } catch (error) {
                log('test1', `Error: ${error.message}`, 'error');
            }
        }
        
        async function testPrivateKeyImport() {
            log('test2', 'Testing private key import functionality...', 'info');
            
            try {
                // Test WIF validation regex
                const WIF_REGEX = /^[5KL][1-9A-HJ-NP-Za-km-z]{50,51}$/;
                
                // Valid WIF examples
                const validWIFs = [
                    '5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss',
                    'KwDiBf89QgGbjEhKnhXJuH7LrciVrZi3qYjgd9M7rFU73sVHnoWn',
                    'L1aW4aubDFB7yfras2S1mN3bqg9nwySY8nkoLmJebSLD5BWv3ENZ'
                ];
                
                validWIFs.forEach(wif => {
                    if (WIF_REGEX.test(wif)) {
                        log('test2', `âœ“ Valid WIF accepted: ${wif.substr(0, 10)}...`, 'success');
                    } else {
                        log('test2', `âœ— Valid WIF rejected: ${wif}`, 'error');
                    }
                });
                
                // Invalid WIF examples
                const invalidWIFs = [
                    '1KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss', // Starts with 1
                    '5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCn', // Too short
                    'MwDiBf89QgGbjEhKnhXJuH7LrciVrZi3qYjgd9M7rFU73sVHnoWn', // Starts with M
                    ''  // Empty
                ];
                
                invalidWIFs.forEach(wif => {
                    if (!WIF_REGEX.test(wif)) {
                        log('test2', `âœ“ Invalid WIF rejected: ${wif || '[empty]'}`, 'success');
                    } else {
                        log('test2', `âœ— Invalid WIF accepted: ${wif}`, 'error');
                    }
                });
                
                log('test2', 'Private key import test completed!', 'success');
            } catch (error) {
                log('test2', `Error: ${error.message}`, 'error');
            }
        }
        
        async function testTabSwitching() {
            log('test3', 'Testing tab switching functionality...', 'info');
            
            try {
                // Create a mock MultiAccountModal
                if (window.MultiAccountModal) {
                    const modal = new MultiAccountModal({
                        state: { get: () => [] },
                        uiPolish: { showNotification: () => {} }
                    });
                    
                    // Test seed mode
                    modal.importMode = 'seed';
                    log('test3', 'âœ“ Set import mode to seed', 'success');
                    
                    // Test private key mode
                    modal.importMode = 'privatekey';
                    log('test3', 'âœ“ Set import mode to privatekey', 'success');
                    
                    // Test form creation
                    if (modal.createImportForm) {
                        const form = modal.createImportForm();
                        if (form) {
                            log('test3', 'âœ“ Import form created successfully', 'success');
                        }
                    }
                } else {
                    log('test3', 'âœ— MultiAccountModal not available', 'error');
                }
                
                log('test3', 'Tab switching test completed!', 'success');
            } catch (error) {
                log('test3', `Error: ${error.message}`, 'error');
            }
        }
        
        async function testWIFValidation() {
            log('test4', 'Testing WIF validation on server...', 'info');
            
            try {
                // Test with a valid test WIF
                const testWIF = '5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss';
                
                const response = await fetch('/api/import/private-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        privateKey: testWIF,
                        deriveAllTypes: true 
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        log('test4', 'âœ“ Server validated WIF successfully', 'success');
                        log('test4', `âœ“ Addresses derived:`, 'success');
                        if (result.addresses) {
                            Object.entries(result.addresses).forEach(([type, addr]) => {
                                log('test4', `  - ${type}: ${addr}`, 'info');
                            });
                        }
                    } else {
                        log('test4', `âœ— Server validation failed: ${result.error}`, 'error');
                    }
                } else {
                    log('test4', `âœ— Server request failed: ${response.status}`, 'error');
                }
                
                log('test4', 'WIF validation test completed!', 'success');
            } catch (error) {
                log('test4', `Error: ${error.message}`, 'error');
            }
        }
        
        // Show initial status
        document.addEventListener('DOMContentLoaded', () => {
            const scripts = [
                'multi-wallet-import-fix.js',
                'private-key-import.js',
                'moosh-wallet.js'
            ];
            
            console.log('=== Multi-Wallet Import Test Suite ===');
            console.log('Checking loaded scripts...');
            
            scripts.forEach(script => {
                const loaded = Array.from(document.scripts).some(s => s.src.includes(script));
                console.log(`${script}: ${loaded ? 'âœ“ Loaded' : 'âœ— Not loaded'}`);
            });
        });
    </script>
</body>
</html>