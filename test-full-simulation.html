<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOOSH Wallet - Full User Simulation Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #f57315;
            font-family: 'Courier New', monospace;
            padding: 20px;
            line-height: 1.6;
        }
        
        .terminal-header {
            border-bottom: 2px solid #f57315;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #f57315;
            font-size: 24px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #333;
            background: #0a0a0a;
        }
        
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #111;
            border-left: 3px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-item.testing {
            border-left-color: #faa307;
            animation: pulse 1s infinite;
        }
        
        .test-item.pass {
            border-left-color: #4CAF50;
        }
        
        .test-item.fail {
            border-left-color: #ff4444;
        }
        
        .test-item.warning {
            border-left-color: #ff8c42;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .status {
            font-weight: bold;
            min-width: 80px;
            text-align: right;
        }
        
        .status.pass { color: #4CAF50; }
        .status.fail { color: #ff4444; }
        .status.warning { color: #ff8c42; }
        .status.testing { color: #faa307; }
        
        button {
            background: #000;
            border: 2px solid #f57315;
            color: #f57315;
            padding: 12px 24px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            transition: all 0.3s;
            margin: 5px;
        }
        
        button:hover {
            background: #f57315;
            color: #000;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .log-output {
            background: #000;
            border: 1px solid #333;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        
        .summary {
            background: #111;
            border: 2px solid #f57315;
            padding: 20px;
            margin-top: 20px;
        }
        
        .summary h3 {
            color: #f57315;
            margin-bottom: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .progress-bar {
            background: #111;
            border: 1px solid #333;
            height: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            background: #f57315;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
        
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            margin: 20px 0;
            background: #000;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="terminal-header">
        <h1>[MOOSH TEST] Full User Simulation</h1>
        <p>Comprehensive testing of all wallet features including Phase 2 implementations</p>
        <p id="test-time"></p>
    </div>

    <div class="test-section">
        <h2>[>] Test Controls</h2>
        <button id="start-test" onclick="startFullTest()">Start Full Test Suite</button>
        <button id="quick-test" onclick="runQuickTest()">Quick Test (Core Features)</button>
        <button id="stop-test" onclick="stopTest()" disabled>Stop Test</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div class="progress-bar">
        <div id="progress-fill" class="progress-fill"></div>
    </div>

    <div class="test-section">
        <h2>[>] Test Categories</h2>
        
        <h3>Core Functionality</h3>
        <div id="core-tests">
            <div class="test-item" data-test="wallet-load">
                <span>Wallet Loading</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="ui-render">
                <span>UI Rendering</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="theme-system">
                <span>Theme System</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="responsive-design">
                <span>Responsive Design</span>
                <span class="status">[--]</span>
            </div>
        </div>
        
        <h3>Account Management</h3>
        <div id="account-tests">
            <div class="test-item" data-test="account-creation">
                <span>Account Creation</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="account-switching">
                <span>Account Switching</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="account-colors">
                <span>Account Colors</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="account-validation">
                <span>Input Validation</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="delete-protection">
                <span>Delete Protection</span>
                <span class="status">[--]</span>
            </div>
        </div>
        
        <h3>Phase 2 Features</h3>
        <div id="phase2-tests">
            <div class="test-item" data-test="drag-drop">
                <span>Drag & Drop Reordering</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="visual-feedback">
                <span>Drag Visual Feedback</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="order-persistence">
                <span>Order Persistence</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="scrollbar-styling">
                <span>Custom Scrollbars</span>
                <span class="status">[--]</span>
            </div>
        </div>
        
        <h3>Compliance & Standards</h3>
        <div id="compliance-tests">
            <div class="test-item" data-test="no-emojis">
                <span>No Emoji Usage</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="color-scheme">
                <span>Orange/Black Theme</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="ascii-indicators">
                <span>ASCII Indicators</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="debouncing">
                <span>Action Debouncing</span>
                <span class="status">[--]</span>
            </div>
        </div>
        
        <h3>Performance</h3>
        <div id="performance-tests">
            <div class="test-item" data-test="load-time">
                <span>Page Load Time</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="memory-usage">
                <span>Memory Usage</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="state-persistence">
                <span>State Persistence</span>
                <span class="status">[--]</span>
            </div>
            <div class="test-item" data-test="error-handling">
                <span>Error Handling</span>
                <span class="status">[--]</span>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>[>] Live Wallet Preview</h2>
        <div class="iframe-container">
            <iframe id="wallet-iframe" src="public/index.html" onload="iframeLoaded()"></iframe>
        </div>
    </div>

    <div class="test-section">
        <h2>[>] Test Log</h2>
        <div id="log-output" class="log-output"></div>
    </div>

    <div class="summary" id="test-summary" style="display: none;">
        <h3>[=] Test Summary</h3>
        <div class="metric">
            <span>Total Tests:</span>
            <span id="total-tests">0</span>
        </div>
        <div class="metric">
            <span>Passed:</span>
            <span id="passed-tests" style="color: #4CAF50;">0</span>
        </div>
        <div class="metric">
            <span>Failed:</span>
            <span id="failed-tests" style="color: #ff4444;">0</span>
        </div>
        <div class="metric">
            <span>Warnings:</span>
            <span id="warning-tests" style="color: #ff8c42;">0</span>
        </div>
        <div class="metric">
            <span>Success Rate:</span>
            <span id="success-rate">0%</span>
        </div>
        <div class="metric">
            <span>Compliance Score:</span>
            <span id="compliance-score">0%</span>
        </div>
    </div>

    <script>
        let testRunning = false;
        let testResults = {};
        let walletWindow = null;
        let startTime = null;
        
        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('test-time').textContent = 
                `Test Date: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // Logging
        function log(message, type = 'info') {
            const logEl = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = {
                'info': '[..]',
                'success': '[OK]',
                'error': '[XX]',
                'warning': '[!!]',
                'test': '[>>]'
            }[type] || '[??]';
            
            logEl.textContent += `${timestamp} ${prefix} ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // Update test status
        function updateTestStatus(testId, status, message) {
            const testEl = document.querySelector(`[data-test="${testId}"]`);
            if (testEl) {
                testEl.className = `test-item ${status}`;
                const statusEl = testEl.querySelector('.status');
                const statusText = {
                    'testing': '[>>]',
                    'pass': '[OK]',
                    'fail': '[XX]',
                    'warning': '[!!]'
                }[status] || '[--]';
                statusEl.textContent = statusText;
                statusEl.className = `status ${status}`;
            }
            
            testResults[testId] = { status, message };
            log(`${testId}: ${message}`, status === 'pass' ? 'success' : status);
            updateProgress();
        }
        
        // Update progress bar
        function updateProgress() {
            const total = document.querySelectorAll('.test-item').length;
            const completed = Object.keys(testResults).length;
            const progress = (completed / total) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }
        
        // iframe loaded
        function iframeLoaded() {
            const iframe = document.getElementById('wallet-iframe');
            walletWindow = iframe.contentWindow;
            log('Wallet iframe loaded', 'success');
        }
        
        // Test implementations
        async function testWalletLoad() {
            updateTestStatus('wallet-load', 'testing', 'Testing wallet load...');
            
            try {
                if (walletWindow && walletWindow.document.readyState === 'complete') {
                    const hasApp = walletWindow.MooshWallet || walletWindow.document.querySelector('#app');
                    if (hasApp) {
                        updateTestStatus('wallet-load', 'pass', 'Wallet loaded successfully');
                    } else {
                        updateTestStatus('wallet-load', 'fail', 'Wallet app not found');
                    }
                } else {
                    updateTestStatus('wallet-load', 'fail', 'Wallet iframe not loaded');
                }
            } catch (error) {
                updateTestStatus('wallet-load', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testUIRender() {
            updateTestStatus('ui-render', 'testing', 'Testing UI rendering...');
            
            try {
                const elements = {
                    terminal: walletWindow.document.querySelector('.terminal-container'),
                    header: walletWindow.document.querySelector('.terminal-header'),
                    content: walletWindow.document.querySelector('.terminal-content')
                };
                
                const allRendered = Object.values(elements).every(el => el !== null);
                
                if (allRendered) {
                    updateTestStatus('ui-render', 'pass', 'All UI elements rendered');
                } else {
                    updateTestStatus('ui-render', 'fail', 'Some UI elements missing');
                }
            } catch (error) {
                updateTestStatus('ui-render', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testThemeSystem() {
            updateTestStatus('theme-system', 'testing', 'Testing theme system...');
            
            try {
                const body = walletWindow.document.body;
                const computedStyle = walletWindow.getComputedStyle(body);
                const bgColor = computedStyle.backgroundColor;
                
                // Check if background is black
                if (bgColor === 'rgb(0, 0, 0)' || bgColor === '#000000') {
                    updateTestStatus('theme-system', 'pass', 'Dark theme active');
                } else {
                    updateTestStatus('theme-system', 'warning', `Background color: ${bgColor}`);
                }
            } catch (error) {
                updateTestStatus('theme-system', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testResponsiveDesign() {
            updateTestStatus('responsive-design', 'testing', 'Testing responsive design...');
            
            try {
                // Check viewport meta tag
                const viewport = walletWindow.document.querySelector('meta[name="viewport"]');
                if (viewport && viewport.content.includes('width=device-width')) {
                    updateTestStatus('responsive-design', 'pass', 'Responsive viewport configured');
                } else {
                    updateTestStatus('responsive-design', 'warning', 'Viewport meta tag issues');
                }
            } catch (error) {
                updateTestStatus('responsive-design', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testAccountCreation() {
            updateTestStatus('account-creation', 'testing', 'Testing account creation...');
            
            try {
                // Check if ComplianceUtils exists
                if (walletWindow.ComplianceUtils && walletWindow.ComplianceUtils.validateInput) {
                    const validation = walletWindow.ComplianceUtils.validateInput('Test Account', 'accountName');
                    if (validation.valid) {
                        updateTestStatus('account-creation', 'pass', 'Account validation working');
                    } else {
                        updateTestStatus('account-creation', 'fail', 'Validation failed');
                    }
                } else {
                    updateTestStatus('account-creation', 'fail', 'ComplianceUtils not found');
                }
            } catch (error) {
                updateTestStatus('account-creation', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testAccountSwitching() {
            updateTestStatus('account-switching', 'testing', 'Testing account switching...');
            
            try {
                // Check if account switcher exists
                const switcher = walletWindow.document.querySelector('.account-switcher, .wallet-icon');
                if (switcher) {
                    updateTestStatus('account-switching', 'pass', 'Account switcher found');
                } else {
                    updateTestStatus('account-switching', 'warning', 'Account switcher not visible');
                }
            } catch (error) {
                updateTestStatus('account-switching', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testAccountColors() {
            updateTestStatus('account-colors', 'testing', 'Testing account colors...');
            
            try {
                // Check color picker elements
                const colorInputs = walletWindow.document.querySelectorAll('input[type="color"]');
                if (colorInputs.length > 0) {
                    updateTestStatus('account-colors', 'pass', `Found ${colorInputs.length} color picker(s)`);
                } else {
                    // Check if account modal exists
                    updateTestStatus('account-colors', 'warning', 'No color pickers visible (modal may be closed)');
                }
            } catch (error) {
                updateTestStatus('account-colors', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testInputValidation() {
            updateTestStatus('account-validation', 'testing', 'Testing input validation...');
            
            try {
                if (walletWindow.ComplianceUtils) {
                    // Test various inputs
                    const tests = [
                        { input: '', type: 'accountName', shouldFail: true },
                        { input: 'Valid Name', type: 'accountName', shouldFail: false },
                        { input: '<script>alert()</script>', type: 'accountName', shouldFail: true },
                        { input: 'A'.repeat(51), type: 'accountName', shouldFail: true }
                    ];
                    
                    let allPassed = true;
                    for (const test of tests) {
                        const result = walletWindow.ComplianceUtils.validateInput(test.input, test.type);
                        if (test.shouldFail && result.valid) {
                            allPassed = false;
                            break;
                        }
                        if (!test.shouldFail && !result.valid) {
                            allPassed = false;
                            break;
                        }
                    }
                    
                    if (allPassed) {
                        updateTestStatus('account-validation', 'pass', 'All validation tests passed');
                    } else {
                        updateTestStatus('account-validation', 'fail', 'Some validation tests failed');
                    }
                } else {
                    updateTestStatus('account-validation', 'fail', 'ComplianceUtils not available');
                }
            } catch (error) {
                updateTestStatus('account-validation', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testDeleteProtection() {
            updateTestStatus('delete-protection', 'testing', 'Testing delete protection...');
            
            try {
                if (walletWindow.ComplianceUtils && walletWindow.ComplianceUtils.canDelete) {
                    // Test delete protection
                    const canDeleteOne = walletWindow.ComplianceUtils.canDelete(1);
                    const canDeleteTwo = walletWindow.ComplianceUtils.canDelete(2);
                    
                    if (!canDeleteOne && canDeleteTwo) {
                        updateTestStatus('delete-protection', 'pass', 'Delete protection working');
                    } else {
                        updateTestStatus('delete-protection', 'fail', 'Delete protection logic error');
                    }
                } else {
                    updateTestStatus('delete-protection', 'fail', 'Delete protection not found');
                }
            } catch (error) {
                updateTestStatus('delete-protection', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testDragDrop() {
            updateTestStatus('drag-drop', 'testing', 'Testing drag & drop...');
            
            try {
                // Check for draggable elements
                const draggables = walletWindow.document.querySelectorAll('[draggable="true"]');
                if (draggables.length > 0) {
                    updateTestStatus('drag-drop', 'pass', `Found ${draggables.length} draggable elements`);
                } else {
                    updateTestStatus('drag-drop', 'warning', 'No draggable elements found (modal may be closed)');
                }
            } catch (error) {
                updateTestStatus('drag-drop', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testVisualFeedback() {
            updateTestStatus('visual-feedback', 'testing', 'Testing visual feedback...');
            
            try {
                // Check for drag styles
                const styles = walletWindow.document.querySelector('style');
                if (styles && styles.textContent.includes('.dragging')) {
                    updateTestStatus('visual-feedback', 'pass', 'Drag visual feedback styles found');
                } else {
                    updateTestStatus('visual-feedback', 'warning', 'Drag styles may not be loaded');
                }
            } catch (error) {
                updateTestStatus('visual-feedback', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testOrderPersistence() {
            updateTestStatus('order-persistence', 'testing', 'Testing order persistence...');
            
            try {
                // Check if reorderAccounts method exists
                if (walletWindow.MooshWallet && 
                    walletWindow.MooshWallet.state && 
                    walletWindow.MooshWallet.state.reorderAccounts) {
                    updateTestStatus('order-persistence', 'pass', 'Account reorder method found');
                } else {
                    updateTestStatus('order-persistence', 'warning', 'Reorder method not accessible');
                }
            } catch (error) {
                updateTestStatus('order-persistence', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testScrollbarStyling() {
            updateTestStatus('scrollbar-styling', 'testing', 'Testing scrollbar styling...');
            
            try {
                // Check for custom scrollbar styles
                const scrollbarStyles = walletWindow.document.getElementById('account-list-modal-scrollbar-styles');
                if (scrollbarStyles) {
                    updateTestStatus('scrollbar-styling', 'pass', 'Custom scrollbar styles applied');
                } else {
                    updateTestStatus('scrollbar-styling', 'warning', 'Scrollbar styles not found (modal may be closed)');
                }
            } catch (error) {
                updateTestStatus('scrollbar-styling', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testNoEmojis() {
            updateTestStatus('no-emojis', 'testing', 'Testing for emoji usage...');
            
            try {
                const bodyText = walletWindow.document.body.innerText;
                const emojiRegex = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu;
                
                if (!emojiRegex.test(bodyText)) {
                    updateTestStatus('no-emojis', 'pass', 'No emojis found');
                } else {
                    updateTestStatus('no-emojis', 'fail', 'Emojis detected in content');
                }
            } catch (error) {
                updateTestStatus('no-emojis', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testColorScheme() {
            updateTestStatus('color-scheme', 'testing', 'Testing color scheme...');
            
            try {
                // Check CSS variables
                const rootStyles = walletWindow.getComputedStyle(walletWindow.document.documentElement);
                const primaryColor = rootStyles.getPropertyValue('--text-primary').trim();
                
                if (primaryColor === '#f57315') {
                    updateTestStatus('color-scheme', 'pass', 'Orange theme active');
                } else {
                    updateTestStatus('color-scheme', 'warning', `Primary color: ${primaryColor}`);
                }
            } catch (error) {
                updateTestStatus('color-scheme', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testAsciiIndicators() {
            updateTestStatus('ascii-indicators', 'testing', 'Testing ASCII indicators...');
            
            try {
                if (walletWindow.ComplianceUtils && walletWindow.ComplianceUtils.getStatusIndicator) {
                    const indicators = ['success', 'error', 'warning', 'info'];
                    let allAscii = true;
                    
                    for (const type of indicators) {
                        const indicator = walletWindow.ComplianceUtils.getStatusIndicator(type);
                        if (!/^[\[\]\w\s\!\?\>\<\=\#\*\~\$]+$/.test(indicator)) {
                            allAscii = false;
                            break;
                        }
                    }
                    
                    if (allAscii) {
                        updateTestStatus('ascii-indicators', 'pass', 'All indicators are ASCII');
                    } else {
                        updateTestStatus('ascii-indicators', 'fail', 'Non-ASCII indicators found');
                    }
                } else {
                    updateTestStatus('ascii-indicators', 'fail', 'Status indicators not found');
                }
            } catch (error) {
                updateTestStatus('ascii-indicators', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testDebouncing() {
            updateTestStatus('debouncing', 'testing', 'Testing debouncing...');
            
            try {
                if (walletWindow.ComplianceUtils && walletWindow.ComplianceUtils.debounce) {
                    updateTestStatus('debouncing', 'pass', 'Debounce utility available');
                } else {
                    updateTestStatus('debouncing', 'fail', 'Debounce utility not found');
                }
            } catch (error) {
                updateTestStatus('debouncing', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testLoadTime() {
            updateTestStatus('load-time', 'testing', 'Testing load time...');
            
            try {
                const loadTime = Date.now() - startTime;
                if (loadTime < 3000) {
                    updateTestStatus('load-time', 'pass', `Loaded in ${loadTime}ms`);
                } else if (loadTime < 5000) {
                    updateTestStatus('load-time', 'warning', `Loaded in ${loadTime}ms (slow)`);
                } else {
                    updateTestStatus('load-time', 'fail', `Loaded in ${loadTime}ms (too slow)`);
                }
            } catch (error) {
                updateTestStatus('load-time', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testMemoryUsage() {
            updateTestStatus('memory-usage', 'testing', 'Testing memory usage...');
            
            try {
                if (performance.memory) {
                    const usedMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                    if (usedMB < 50) {
                        updateTestStatus('memory-usage', 'pass', `Using ${usedMB}MB`);
                    } else if (usedMB < 100) {
                        updateTestStatus('memory-usage', 'warning', `Using ${usedMB}MB (high)`);
                    } else {
                        updateTestStatus('memory-usage', 'fail', `Using ${usedMB}MB (too high)`);
                    }
                } else {
                    updateTestStatus('memory-usage', 'warning', 'Memory API not available');
                }
            } catch (error) {
                updateTestStatus('memory-usage', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testStatePersistence() {
            updateTestStatus('state-persistence', 'testing', 'Testing state persistence...');
            
            try {
                // Check localStorage
                const mooshAccounts = walletWindow.localStorage.getItem('mooshAccounts');
                if (mooshAccounts) {
                    const data = JSON.parse(mooshAccounts);
                    if (data.accounts && data.currentAccountId) {
                        updateTestStatus('state-persistence', 'pass', 'State properly persisted');
                    } else {
                        updateTestStatus('state-persistence', 'warning', 'Incomplete state data');
                    }
                } else {
                    updateTestStatus('state-persistence', 'warning', 'No persisted state found');
                }
            } catch (error) {
                updateTestStatus('state-persistence', 'fail', `Error: ${error.message}`);
            }
        }
        
        async function testErrorHandling() {
            updateTestStatus('error-handling', 'testing', 'Testing error handling...');
            
            try {
                // Check if error boundaries exist
                const hasErrorHandling = walletWindow.console.error.toString().includes('native code') === false;
                if (hasErrorHandling) {
                    updateTestStatus('error-handling', 'warning', 'Custom error handling detected');
                } else {
                    updateTestStatus('error-handling', 'pass', 'Standard error handling in place');
                }
            } catch (error) {
                updateTestStatus('error-handling', 'fail', `Error: ${error.message}`);
            }
        }
        
        // Run all tests
        async function startFullTest() {
            if (testRunning) return;
            
            testRunning = true;
            startTime = Date.now();
            testResults = {};
            
            document.getElementById('start-test').disabled = true;
            document.getElementById('quick-test').disabled = true;
            document.getElementById('stop-test').disabled = false;
            document.getElementById('test-summary').style.display = 'none';
            
            log('Starting full test suite...', 'test');
            
            // Core functionality
            await testWalletLoad();
            await delay(500);
            
            await testUIRender();
            await delay(300);
            
            await testThemeSystem();
            await delay(300);
            
            await testResponsiveDesign();
            await delay(300);
            
            // Account management
            await testAccountCreation();
            await delay(300);
            
            await testAccountSwitching();
            await delay(300);
            
            await testAccountColors();
            await delay(300);
            
            await testInputValidation();
            await delay(300);
            
            await testDeleteProtection();
            await delay(300);
            
            // Phase 2 features
            await testDragDrop();
            await delay(300);
            
            await testVisualFeedback();
            await delay(300);
            
            await testOrderPersistence();
            await delay(300);
            
            await testScrollbarStyling();
            await delay(300);
            
            // Compliance
            await testNoEmojis();
            await delay(300);
            
            await testColorScheme();
            await delay(300);
            
            await testAsciiIndicators();
            await delay(300);
            
            await testDebouncing();
            await delay(300);
            
            // Performance
            await testLoadTime();
            await delay(300);
            
            await testMemoryUsage();
            await delay(300);
            
            await testStatePersistence();
            await delay(300);
            
            await testErrorHandling();
            await delay(300);
            
            // Show summary
            showTestSummary();
            
            testRunning = false;
            document.getElementById('start-test').disabled = false;
            document.getElementById('quick-test').disabled = false;
            document.getElementById('stop-test').disabled = true;
        }
        
        // Quick test (core features only)
        async function runQuickTest() {
            if (testRunning) return;
            
            testRunning = true;
            startTime = Date.now();
            testResults = {};
            
            document.getElementById('start-test').disabled = true;
            document.getElementById('quick-test').disabled = true;
            document.getElementById('stop-test').disabled = false;
            
            log('Running quick test...', 'test');
            
            await testWalletLoad();
            await delay(300);
            await testUIRender();
            await delay(300);
            await testDragDrop();
            await delay(300);
            await testInputValidation();
            await delay(300);
            await testNoEmojis();
            
            showTestSummary();
            
            testRunning = false;
            document.getElementById('start-test').disabled = false;
            document.getElementById('quick-test').disabled = false;
            document.getElementById('stop-test').disabled = true;
        }
        
        // Stop test
        function stopTest() {
            testRunning = false;
            log('Test stopped by user', 'warning');
            document.getElementById('start-test').disabled = false;
            document.getElementById('quick-test').disabled = false;
            document.getElementById('stop-test').disabled = true;
        }
        
        // Clear results
        function clearResults() {
            document.getElementById('log-output').textContent = '';
            document.querySelectorAll('.test-item').forEach(el => {
                el.className = 'test-item';
                el.querySelector('.status').textContent = '[--]';
                el.querySelector('.status').className = 'status';
            });
            document.getElementById('progress-fill').style.width = '0%';
            document.getElementById('test-summary').style.display = 'none';
            testResults = {};
            log('Results cleared', 'info');
        }
        
        // Show test summary
        function showTestSummary() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r.status === 'pass').length;
            const failed = Object.values(testResults).filter(r => r.status === 'fail').length;
            const warnings = Object.values(testResults).filter(r => r.status === 'warning').length;
            
            const successRate = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            // Calculate compliance score
            const complianceTests = ['no-emojis', 'color-scheme', 'ascii-indicators', 'debouncing', 'account-validation', 'delete-protection'];
            const compliancePassed = complianceTests.filter(test => 
                testResults[test] && testResults[test].status === 'pass'
            ).length;
            const complianceScore = Math.round((compliancePassed / complianceTests.length) * 100);
            
            document.getElementById('total-tests').textContent = total;
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('warning-tests').textContent = warnings;
            document.getElementById('success-rate').textContent = successRate + '%';
            document.getElementById('compliance-score').textContent = complianceScore + '%';
            
            document.getElementById('test-summary').style.display = 'block';
            
            log(`Test suite completed: ${passed}/${total} passed (${successRate}% success rate)`, 
                failed === 0 ? 'success' : 'warning');
        }
        
        // Utility delay function
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Auto-start quick test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('Test page ready. Click "Start Full Test Suite" to begin comprehensive testing.', 'info');
            }, 1000);
        });
    </script>
</body>
</html>