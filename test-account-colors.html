<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Colors Test - MOOSH Wallet</title>
    <link rel="stylesheet" href="css/app.css">
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #111;
            border: 2px solid #333;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-button {
            padding: 10px 20px;
            background: #000;
            border: 2px solid #f57315;
            color: #f57315;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #f57315;
            color: #000;
        }
        
        .results {
            background: #000;
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            white-space: pre-wrap;
            font-size: 12px;
        }
        
        .success { color: #69fd97; }
        .error { color: #ff4444; }
        .info { color: #00d4ff; }
        .warning { color: #f57315; }
        
        .color-preview {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin: 0 5px;
            vertical-align: middle;
            border: 1px solid #666;
        }
        
        .feature-summary {
            background: #002200;
            border: 2px solid #69fd97;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <div class="test-container">
        <h1 style="color: #f57315; text-align: center;">ACCOUNT COLORS FEATURE TEST</h1>
        
        <div class="feature-summary">
            <h3 style="color: #69fd97;">Phase 2 Feature: Account Colors</h3>
            <p><strong>Purpose:</strong> Visual identification of accounts using color-coded borders and accents</p>
            <p><strong>Implementation:</strong></p>
            <ul>
                <li>✓ Each account gets a unique color from predefined palette</li>
                <li>✓ Colors shown as left border on account cards</li>
                <li>✓ Account names use their assigned color</li>
                <li>✓ Active account banner uses account color</li>
                <li>✓ Color picker for changing account colors</li>
                <li>✓ Colors persist in localStorage</li>
                <li>✓ Works in all view modes (GRID, LIST, DETAILS)</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>Color Palette</h3>
            <div id="colorPalette"></div>
        </div>
        
        <div class="test-section">
            <h3>Test Actions</h3>
            <button class="test-button" onclick="testColorAssignment()">TEST COLOR ASSIGNMENT</button>
            <button class="test-button" onclick="testColorPicker()">TEST COLOR PICKER</button>
            <button class="test-button" onclick="testViewModes()">TEST ALL VIEW MODES</button>
            <button class="test-button" onclick="openAccountManager()">OPEN ACCOUNT MANAGER</button>
        </div>
        
        <div class="results" id="results">
            <span class="info">Click test buttons to verify account colors feature.</span>
        </div>
    </div>
    
    <script src="js/moosh-wallet.js"></script>
    <script>
        const results = document.getElementById('results');
        let testLog = [];
        
        function log(message, type = 'info') {
            const time = new Date().toTimeString().split(' ')[0];
            testLog.push(`<span class="${type}">[${time}] ${message}</span>`);
            results.innerHTML = testLog.join('\n');
            results.scrollTop = results.scrollHeight;
        }
        
        function clearLog() {
            testLog = [];
            results.innerHTML = '';
        }
        
        // Display color palette
        window.addEventListener('load', () => {
            const paletteDiv = document.getElementById('colorPalette');
            const colors = window.app.state.getAccountColors();
            
            colors.forEach((color, index) => {
                const colorEl = document.createElement('span');
                colorEl.innerHTML = `Color ${index + 1}: <span class="color-preview" style="background: ${color};"></span> ${color}`;
                colorEl.style.marginRight = '20px';
                paletteDiv.appendChild(colorEl);
            });
        });
        
        function testColorAssignment() {
            clearLog();
            log('=== TESTING COLOR ASSIGNMENT ===', 'info');
            
            const accounts = window.app.state.get('accounts') || [];
            const colors = window.app.state.getAccountColors();
            
            log(`Total accounts: ${accounts.length}`, 'info');
            log(`Available colors: ${colors.length}`, 'info');
            
            // Check if all accounts have colors
            let allHaveColors = true;
            accounts.forEach((account, index) => {
                if (account.color) {
                    log(`✓ Account "${account.name}" has color: ${account.color}`, 'success');
                } else {
                    log(`✗ Account "${account.name}" missing color`, 'error');
                    allHaveColors = false;
                }
            });
            
            if (allHaveColors) {
                log('\n✅ All accounts have colors assigned!', 'success');
            } else {
                log('\n❌ Some accounts missing colors', 'error');
            }
            
            // Test getNextAccountColor
            log('\nTesting getNextAccountColor()...', 'info');
            const nextColor = window.app.state.getNextAccountColor();
            log(`Next available color: ${nextColor}`, 'info');
            
            // Check for unique colors
            const usedColors = accounts.map(acc => acc.color).filter(Boolean);
            const uniqueColors = [...new Set(usedColors)];
            
            if (uniqueColors.length === usedColors.length) {
                log('\n✅ All accounts have unique colors', 'success');
            } else {
                log(`\n⚠️ Some colors are reused (${uniqueColors.length} unique out of ${usedColors.length})`, 'warning');
            }
        }
        
        function testColorPicker() {
            clearLog();
            log('=== TESTING COLOR PICKER ===', 'info');
            
            // Open account manager
            const modal = new AccountListModal(window.app);
            modal.show();
            
            setTimeout(() => {
                const modalEl = document.querySelector('.account-list-modal');
                if (!modalEl) {
                    log('✗ Account manager not found', 'error');
                    return;
                }
                
                log('✓ Account manager opened', 'success');
                
                // Find COLOR buttons
                const colorButtons = Array.from(modalEl.querySelectorAll('button')).filter(
                    btn => btn.textContent === 'COLOR'
                );
                
                log(`Found ${colorButtons.length} COLOR buttons`, 'info');
                
                if (colorButtons.length > 0) {
                    log('✓ COLOR buttons present on account cards', 'success');
                    
                    // Click first COLOR button
                    log('Clicking first COLOR button...', 'info');
                    colorButtons[0].click();
                    
                    setTimeout(() => {
                        const colorPicker = document.querySelector('[style*="position: fixed"]');
                        if (colorPicker) {
                            log('✓ Color picker overlay opened', 'success');
                            
                            // Check for color buttons
                            const colorOptions = colorPicker.querySelectorAll('button[style*="width: 60px"]');
                            log(`✓ Found ${colorOptions.length} color options`, 'success');
                            
                            // Close color picker
                            const cancelBtn = Array.from(colorPicker.querySelectorAll('button')).find(
                                btn => btn.textContent === 'CANCEL'
                            );
                            if (cancelBtn) cancelBtn.click();
                            
                            log('\n✅ Color picker working correctly!', 'success');
                        } else {
                            log('✗ Color picker not found', 'error');
                        }
                        
                        // Close modal
                        const closeBtn = modalEl.querySelector('button[onclick*="close"]');
                        if (closeBtn) closeBtn.click();
                        
                    }, 500);
                } else {
                    log('✗ No COLOR buttons found', 'error');
                }
            }, 500);
        }
        
        async function testViewModes() {
            clearLog();
            log('=== TESTING COLORS IN ALL VIEW MODES ===', 'info');
            
            const modal = new AccountListModal(window.app);
            modal.show();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const modalEl = document.querySelector('.account-list-modal');
            if (!modalEl) {
                log('✗ Account manager not found', 'error');
                return;
            }
            
            // Test each view mode
            const viewModes = ['GRID', 'LIST', 'DETAILS'];
            
            for (const mode of viewModes) {
                log(`\nTesting ${mode} view...`, 'info');
                
                // Find and click view button
                const viewBtn = Array.from(modalEl.querySelectorAll('button')).find(
                    btn => btn.textContent === mode
                );
                
                if (viewBtn) {
                    viewBtn.click();
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Check for colored elements
                    const accountGrid = modalEl.querySelector('.account-grid');
                    if (accountGrid) {
                        // Check for color borders
                        const coloredBorders = accountGrid.querySelectorAll('[style*="borderLeft"]');
                        if (coloredBorders.length > 0) {
                            log(`✓ ${mode} view: Found ${coloredBorders.length} colored borders`, 'success');
                        }
                        
                        // Check for colored names
                        const firstAccount = window.app.state.get('accounts')[0];
                        if (firstAccount && firstAccount.color) {
                            const coloredNames = accountGrid.querySelectorAll(`[style*="${firstAccount.color}"]`);
                            if (coloredNames.length > 0) {
                                log(`✓ ${mode} view: Account names using custom colors`, 'success');
                            }
                        }
                    }
                }
            }
            
            // Close modal
            const closeBtn = modalEl.querySelector('button[onclick*="close"]');
            if (closeBtn) closeBtn.click();
            
            log('\n✅ Color feature works in all view modes!', 'success');
        }
        
        function openAccountManager() {
            const modal = new AccountListModal(window.app);
            modal.show();
        }
        
        // Initial message
        setTimeout(() => {
            log('Account Colors feature ready for testing!', 'info');
            log('This is a Phase 2 enhancement for visual account identification.', 'info');
        }, 500);
    </script>
</body>
</html>