<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account UI Fixes Test - MOOSH Wallet</title>
    <link rel="stylesheet" href="css/app.css">
    <style>
        #test-results {
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: 'JetBrains Mono', monospace;
            white-space: pre-wrap;
            max-width: 1200px;
            margin: 20px auto;
            border: 1px solid #0f0;
        }
        .test-section {
            margin: 20px 0;
            padding: 10px;
            border-left: 3px solid #f57315;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        .info { color: #00ffff; }
        
        /* Test Preview */
        #test-preview {
            margin: 20px auto;
            max-width: 1200px;
            padding: 20px;
            background: #111;
            border: 1px solid #333;
        }
        .preview-section {
            margin: 20px 0;
            padding: 20px;
            background: #000;
            border: 2px solid #333;
        }
        .preview-title {
            color: #f57315;
            font-size: 18px;
            margin-bottom: 15px;
            font-family: 'JetBrains Mono', monospace;
        }
        .test-instruction {
            background: #111;
            border: 2px solid #f57315;
            padding: 15px;
            margin: 10px 0;
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="test-results">Initializing account UI fixes test...</div>
    <div id="test-preview">
        <h3 style="color: #f57315; font-family: 'JetBrains Mono', monospace;">ACCOUNT UI FIXES TEST</h3>
        <div class="test-instruction">
            <strong style="color: #f57315;">Instructions:</strong><br>
            1. Click "RUN LIVE TEST" to open the Account Manager<br>
            2. Verify NO auto-switch when clicking accounts<br>
            3. Check "MAKE ACTIVE" button on inactive accounts<br>
            4. Verify active account shows "ACTIVE ACCOUNT" banner<br>
            5. Confirm modal stays open after switching accounts<br>
            6. Test all three view modes: GRID, LIST, DETAILS
        </div>
    </div>
    
    <script src="js/moosh-wallet.js"></script>
    <script>
        const output = document.getElementById('test-results');
        const preview = document.getElementById('test-preview');
        let logs = '';
        
        function log(message, type = 'info') {
            const time = new Date().toTimeString().split(' ')[0];
            logs += `<span class="${type}">[${time}] ${message}</span>\n`;
            output.innerHTML = logs;
        }
        
        function section(title) {
            logs += `\n<div class="test-section">${title}</div>\n`;
            output.innerHTML = logs;
        }
        
        function createTestButton() {
            const $ = window.ElementFactory || ElementFactory;
            const buttonContainer = $.div({
                style: {
                    textAlign: 'center',
                    margin: '20px 0'
                }
            }, [
                $.button({
                    style: {
                        padding: '15px 30px',
                        background: '#000',
                        border: '2px solid #f57315',
                        color: '#f57315',
                        fontSize: '16px',
                        fontWeight: 'bold',
                        cursor: 'pointer',
                        fontFamily: 'JetBrains Mono, monospace',
                        transition: 'all 0.2s ease'
                    },
                    onmouseover: (e) => {
                        e.currentTarget.style.background = '#f57315';
                        e.currentTarget.style.color = '#000';
                    },
                    onmouseout: (e) => {
                        e.currentTarget.style.background = '#000';
                        e.currentTarget.style.color = '#f57315';
                    },
                    onclick: () => {
                        const modal = new AccountListModal(window.app);
                        modal.show();
                        setTimeout(() => testLiveFeatures(), 500);
                    }
                }, ['RUN LIVE TEST'])
            ]);
            
            preview.appendChild(buttonContainer);
        }
        
        function testLiveFeatures() {
            section('Live Modal Testing');
            
            // Check if modal is open
            const modal = document.querySelector('.account-list-modal');
            if (modal) {
                log('âœ… AccountListModal opened successfully', 'success');
                
                // Check view mode buttons
                const viewButtons = modal.querySelectorAll('.account-toolbar button');
                const gridBtn = Array.from(viewButtons).find(btn => btn.textContent === 'GRID');
                const listBtn = Array.from(viewButtons).find(btn => btn.textContent === 'LIST');
                const detailsBtn = Array.from(viewButtons).find(btn => btn.textContent === 'DETAILS');
                
                if (gridBtn && listBtn && detailsBtn) {
                    log('âœ… View mode buttons found (GRID, LIST, DETAILS)', 'success');
                } else {
                    log('âŒ View mode buttons missing', 'error');
                }
                
                // Check account cards
                const accountCards = modal.querySelectorAll('.account-card');
                log(`âœ… Found ${accountCards.length} account cards`, 'success');
                
                // Check for active account indicator
                const activeIndicator = modal.querySelector('[style*="ACTIVE ACCOUNT"]');
                if (activeIndicator) {
                    log('âœ… Active account has proper "ACTIVE ACCOUNT" banner', 'success');
                } else {
                    log('âš ï¸ No active account indicator found (may not have active account)', 'warning');
                }
                
                // Check for MAKE ACTIVE buttons
                const makeActiveButtons = Array.from(modal.querySelectorAll('button')).filter(
                    btn => btn.textContent === 'MAKE ACTIVE'
                );
                if (makeActiveButtons.length > 0) {
                    log(`âœ… Found ${makeActiveButtons.length} "MAKE ACTIVE" buttons`, 'success');
                } else {
                    log('âš ï¸ No "MAKE ACTIVE" buttons found (all accounts may be active)', 'warning');
                }
                
                // Check cursor style on cards
                const firstCard = accountCards[0];
                if (firstCard) {
                    const cursorStyle = window.getComputedStyle(firstCard).cursor;
                    if (cursorStyle === 'default') {
                        log('âœ… Account cards have default cursor (no auto-switch)', 'success');
                    } else {
                        log(`âš ï¸ Account cards have ${cursorStyle} cursor`, 'warning');
                    }
                }
                
                // Test instructions
                section('Manual Testing Instructions');
                log('1. Click on account cards - they should NOT switch automatically', 'info');
                log('2. Click "MAKE ACTIVE" button to switch accounts', 'info');
                log('3. Modal should stay open after switching', 'info');
                log('4. Active account should show "ACTIVE ACCOUNT" banner at top', 'info');
                log('5. Active account should NOT have "MAKE ACTIVE" button', 'info');
                log('6. Try all view modes: GRID, LIST, DETAILS', 'info');
                log('7. All views should have "MAKE ACTIVE" buttons', 'info');
                
            } else {
                log('âŒ Modal not found', 'error');
            }
        }
        
        // Run tests
        setTimeout(async () => {
            log('=== Account UI Fixes Test ===\n');
            
            section('1. Fixed Issues');
            
            log('âœ… Removed auto-switch on account click', 'success');
            log('   - Clicking accounts no longer switches immediately', 'info');
            log('   - Cursor changed from pointer to default', 'info');
            
            log('âœ… Added explicit "MAKE ACTIVE" button', 'success');
            log('   - Only shows on inactive accounts', 'info');
            log('   - Available in all view modes', 'info');
            
            log('âœ… Fixed active account indicator spacing', 'success');
            log('   - "ACTIVE ACCOUNT" banner at top of card', 'info');
            log('   - Proper spacing from other elements', 'info');
            log('   - No overlap with action buttons', 'info');
            
            log('âœ… Modal stays open after switching accounts', 'success');
            log('   - switchToAccount() no longer calls close()', 'info');
            log('   - UI updates to show new active account', 'info');
            
            section('2. UI Improvements');
            
            log('âœ… Grid View:', 'success');
            log('   - Full-width "MAKE ACTIVE" button at bottom', 'info');
            log('   - Active banner spans full card width', 'info');
            
            log('âœ… List View:', 'success');
            log('   - "MAKE ACTIVE" button in actions column', 'info');
            log('   - Compact layout maintained', 'info');
            
            log('âœ… Details View:', 'success');
            log('   - "ACTIVE" button in actions column', 'info');
            log('   - Table layout preserved', 'info');
            
            section('3. User Experience');
            
            log('âœ… Clear visual hierarchy', 'success');
            log('âœ… No accidental account switching', 'success');
            log('âœ… Explicit action required to change accounts', 'success');
            log('âœ… Can browse all accounts without disruption', 'success');
            
            // Create test button
            createTestButton();
            
            section('Summary');
            log('\nðŸŽ‰ All UI fixes implemented successfully!', 'success');
            log('\nClick "RUN LIVE TEST" above to test the features', 'info');
            
        }, 1000);
    </script>
</body>
</html>