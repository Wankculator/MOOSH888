#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running MCP validations before commit..."

# Run memory check
echo "ğŸ“Š Checking memory usage..."
npm run mcp:memory || {
    echo "âŒ Memory check failed! Fix issues before committing."
    echo "ğŸ’¡ Tip: Balance event listeners and consider code splitting"
    exit 1
}

# Run security check
echo "ğŸ” Running security scan..."
npm run mcp:security || {
    echo "âŒ Security check failed! Fix critical issues before committing."
    echo "ğŸ’¡ Tip: Replace Math.random with crypto.randomBytes"
    exit 1
}

# Run linting
npm run lint || {
    echo "âŒ Linting failed. Please fix errors before committing."
    exit 1
}

# Run tests
npm test || {
    echo "âŒ Tests failed. Please fix failing tests before committing."
    exit 1
}

# Check for security vulnerabilities
npm audit --audit-level=high || {
    echo "âš ï¸  Security vulnerabilities found. Please review before committing."
}

echo "âœ… Pre-commit checks passed!"