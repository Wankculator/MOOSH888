<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Toggle Test</title>
    <style>
        body {
            margin: 20px;
            font-family: monospace;
            background: #000;
            color: #f57315;
        }
        
        .test-box {
            border: 2px solid #f57315;
            padding: 20px;
            margin: 20px 0;
        }
        
        .theme-status {
            margin: 10px 0;
            padding: 10px;
            background: #111;
        }
        
        button {
            background: #000;
            color: #f57315;
            border: 2px solid #f57315;
            padding: 10px 20px;
            cursor: pointer;
            font-family: monospace;
        }
        
        button:hover {
            background: #f57315;
            color: #000;
        }
    </style>
</head>
<body>
    <h1>MOOSH Wallet Theme Toggle Test</h1>
    
    <div class="test-box">
        <h2>Current Status:</h2>
        <div class="theme-status">
            <p>Body Classes: <span id="bodyClasses"></span></p>
            <p>Theme in State: <span id="themeState">false</span></p>
            <p>CSS Variables:</p>
            <ul>
                <li>--text-primary: <span id="textPrimary"></span></li>
                <li>--bg-primary: <span id="bgPrimary"></span></li>
            </ul>
        </div>
        
        <button onclick="testThemeToggle()">Test Theme Toggle</button>
        <button onclick="checkCSSLoaded()">Check CSS Loaded</button>
        <button onclick="manualToggle()">Manual Toggle</button>
    </div>
    
    <div class="test-box">
        <h2>Console Output:</h2>
        <div id="console" style="background: #000; padding: 10px; height: 200px; overflow-y: auto; font-size: 12px;"></div>
    </div>

    <script>
        // Simulate minimal state manager
        const state = {
            isSparkTheme: false,
            get: function(key) { return this[key]; },
            set: function(key, value) { 
                this[key] = value; 
                log(`State updated: ${key} = ${value}`);
            }
        };

        // Log function
        function log(msg) {
            const console = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            console.innerHTML += `[${time}] ${msg}<br>`;
            console.scrollTop = console.scrollHeight;
        }

        // Update status display
        function updateStatus() {
            document.getElementById('bodyClasses').textContent = document.body.className || '(none)';
            document.getElementById('themeState').textContent = state.isSparkTheme;
            
            const styles = getComputedStyle(document.documentElement);
            document.getElementById('textPrimary').textContent = styles.getPropertyValue('--text-primary');
            document.getElementById('bgPrimary').textContent = styles.getPropertyValue('--bg-primary');
        }

        // Test theme toggle function
        function testThemeToggle() {
            log('Testing theme toggle...');
            
            const isSparkTheme = !state.get('isSparkTheme');
            state.set('isSparkTheme', isSparkTheme);
            
            if (isSparkTheme) {
                document.body.classList.add('theme-spark');
                log('Added theme-spark class to body');
                localStorage.setItem('mooshTheme', 'moosh');
            } else {
                document.body.classList.remove('theme-spark');
                log('Removed theme-spark class from body');
                localStorage.setItem('mooshTheme', 'original');
            }
            
            updateStatus();
        }

        // Check if CSS is loaded
        function checkCSSLoaded() {
            log('Checking CSS...');
            
            // Check for theme-spark styles
            const testDiv = document.createElement('div');
            testDiv.className = 'theme-spark';
            document.body.appendChild(testDiv);
            
            const styles = getComputedStyle(testDiv);
            log(`Test div color: ${styles.color}`);
            
            document.body.removeChild(testDiv);
            
            // Check stylesheets
            log(`Number of stylesheets: ${document.styleSheets.length}`);
            
            // Check for MOOSH wallet styles
            const hasThemeStyles = Array.from(document.styleSheets).some(sheet => {
                try {
                    return Array.from(sheet.cssRules || []).some(rule => 
                        rule.selectorText && rule.selectorText.includes('theme-spark')
                    );
                } catch(e) {
                    return false;
                }
            });
            
            log(`Has theme-spark styles: ${hasThemeStyles}`);
        }

        // Manual toggle for testing
        function manualToggle() {
            if (document.body.classList.contains('theme-spark')) {
                document.body.classList.remove('theme-spark');
                log('Manually removed theme-spark class');
            } else {
                document.body.classList.add('theme-spark');
                log('Manually added theme-spark class');
            }
            updateStatus();
        }

        // Initialize
        log('Theme test initialized');
        updateStatus();
        
        // Load theme preference
        const savedTheme = localStorage.getItem('mooshTheme');
        log(`Saved theme preference: ${savedTheme}`);
        if (savedTheme === 'moosh') {
            state.isSparkTheme = true;
            document.body.classList.add('theme-spark');
        }
        updateStatus();
    </script>
</body>
</html>