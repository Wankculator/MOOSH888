<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme-Aware Currency Selector Test - MOOSH Wallet</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #f57315;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .test-header {
            border: 2px solid #f57315;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-section {
            border: 1px solid #333;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #ff8c42;
        }
        
        button {
            background: #000;
            border: 2px solid #f57315;
            color: #f57315;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background: #f57315;
            color: #000;
        }
        
        .status {
            margin: 10px 0;
            padding: 10px;
            border: 1px dashed #666;
            font-size: 12px;
        }
        
        .success { color: #69fd97; }
        .error { color: #ff4444; }
        .info { color: #00bfff; }
        
        /* Moosh mode overrides */
        body.moosh-mode {
            color: #69fd97;
        }
        
        body.moosh-mode .test-header {
            border-color: #69fd97;
        }
        
        body.moosh-mode button {
            border-color: #69fd97;
            color: #69fd97;
        }
        
        body.moosh-mode button:hover {
            background: #69fd97;
            color: #000;
        }
        
        body.moosh-mode h3 {
            color: #7fffb3;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-item {
            border: 1px solid #333;
            padding: 15px;
        }
        
        .comparison-item h4 {
            margin-top: 0;
            color: #faa307;
        }
        
        #preview-container {
            margin-top: 20px;
            padding: 20px;
            border: 2px dashed #666;
            min-height: 200px;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>[==] THEME-AWARE CURRENCY SELECTOR TEST [==]</h1>
        <p>Testing currency selector theme adaptation in AccountListModal</p>
    </div>
    
    <div class="test-section">
        <h3>[>] Test Controls</h3>
        <button onclick="toggleTheme()">Toggle Theme Mode</button>
        <button onclick="openAccountListModal()">Open Account List Modal</button>
        <button onclick="checkCurrentTheme()">Check Current Theme</button>
        <button onclick="inspectCurrencySelector()">Inspect Currency Selector</button>
    </div>
    
    <div class="test-section">
        <h3>[>] Current State</h3>
        <div id="theme-status" class="status info">Theme: Original (Orange)</div>
        <div id="selector-status" class="status info">Currency Selector: Not initialized</div>
        <div id="color-status" class="status info">Colors: Primary=#f57315, Hover=#ff8c42</div>
    </div>
    
    <div class="test-section">
        <h3>[>] Test Results</h3>
        <div id="test-results">
            <p>Click "Open Account List Modal" to test the currency selector...</p>
        </div>
    </div>
    
    <div class="test-section">
        <h3>[>] Color Comparison</h3>
        <div class="comparison-grid">
            <div class="comparison-item">
                <h4>Original Mode (Orange)</h4>
                <ul>
                    <li>Primary: #f57315</li>
                    <li>Hover: #ff8c42</li>
                    <li>Border: #f57315</li>
                    <li>Dropdown Arrow: #f57315</li>
                    <li>Option Text: #f57315</li>
                    <li>Selected Option: #ff8c42</li>
                </ul>
            </div>
            <div class="comparison-item">
                <h4>Moosh Mode (Green)</h4>
                <ul>
                    <li>Primary: #69fd97</li>
                    <li>Hover: #7fffb3</li>
                    <li>Border: #69fd97</li>
                    <li>Dropdown Arrow: #69fd97</li>
                    <li>Option Text: #69fd97</li>
                    <li>Selected Option: #7fffb3</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>[>] Preview Container</h3>
        <div id="preview-container">
            <!-- Modal preview will appear here -->
        </div>
    </div>
    
    <!-- Load MOOSH Wallet -->
    <script src="/public/js/moosh-wallet.js"></script>
    
    <script>
        let app = null;
        let accountListModal = null;
        
        // Initialize the app
        window.addEventListener('DOMContentLoaded', () => {
            try {
                app = new MOOSHWallet();
                // Initialize with a test account
                app.state.set('accounts', [{
                    id: 'test-1',
                    name: 'Test Account',
                    addresses: { bitcoin: 'bc1test...', segwit: '3test...' },
                    createdAt: Date.now()
                }]);
                app.state.set('currentAccountId', 'test-1');
                
                updateStatus('App initialized', 'success');
                checkCurrentTheme();
            } catch (error) {
                updateStatus('Failed to initialize: ' + error.message, 'error');
            }
        });
        
        function toggleTheme() {
            const isMooshMode = document.body.classList.contains('moosh-mode');
            if (isMooshMode) {
                document.body.classList.remove('moosh-mode');
                localStorage.setItem('mooshTheme', 'original');
            } else {
                document.body.classList.add('moosh-mode');
                localStorage.setItem('mooshTheme', 'moosh');
            }
            
            checkCurrentTheme();
            updateStatus('Theme toggled', 'success');
            
            // If modal is open, close and reopen to see changes
            if (accountListModal && accountListModal.modal) {
                accountListModal.close();
                setTimeout(() => openAccountListModal(), 100);
            }
        }
        
        function checkCurrentTheme() {
            const isMooshMode = document.body.classList.contains('moosh-mode');
            const themeStatus = document.getElementById('theme-status');
            const colorStatus = document.getElementById('color-status');
            
            if (isMooshMode) {
                themeStatus.textContent = 'Theme: Moosh (Green)';
                themeStatus.className = 'status success';
                colorStatus.textContent = 'Colors: Primary=#69fd97, Hover=#7fffb3';
                colorStatus.className = 'status success';
            } else {
                themeStatus.textContent = 'Theme: Original (Orange)';
                themeStatus.className = 'status info';
                colorStatus.textContent = 'Colors: Primary=#f57315, Hover=#ff8c42';
                colorStatus.className = 'status info';
            }
        }
        
        function openAccountListModal() {
            if (!app) {
                updateStatus('App not initialized', 'error');
                return;
            }
            
            try {
                accountListModal = new AccountListModal(app);
                accountListModal.show();
                updateStatus('AccountListModal opened', 'success');
                
                // Wait for modal to render then inspect
                setTimeout(() => inspectCurrencySelector(), 500);
            } catch (error) {
                updateStatus('Failed to open modal: ' + error.message, 'error');
            }
        }
        
        function inspectCurrencySelector() {
            const selector = document.getElementById('currency-selector');
            const selectorStyles = document.getElementById('currency-selector-styles');
            const results = document.getElementById('test-results');
            
            if (!selector) {
                updateStatus('Currency selector not found', 'error');
                results.innerHTML = '<p class="error">Currency selector element not found in DOM</p>';
                return;
            }
            
            const computedStyle = window.getComputedStyle(selector);
            const borderColor = computedStyle.borderColor;
            const color = computedStyle.color;
            const backgroundImage = computedStyle.backgroundImage;
            
            // Extract SVG color from background image
            const svgColorMatch = backgroundImage.match(/stroke='%23([a-fA-F0-9]{6})'/);
            const svgColor = svgColorMatch ? '#' + svgColorMatch[1] : 'Not found';
            
            // Check if styles are applied
            const stylesApplied = selectorStyles !== null;
            const isMooshMode = document.body.classList.contains('moosh-mode');
            const expectedColor = isMooshMode ? '#69fd97' : '#f57315';
            
            results.innerHTML = `
                <h4>[OK] Currency Selector Inspection Results:</h4>
                <ul>
                    <li>Element Found: <span class="success">YES</span></li>
                    <li>Styles Applied: <span class="${stylesApplied ? 'success' : 'error'}">${stylesApplied ? 'YES' : 'NO'}</span></li>
                    <li>Current Mode: <span class="${isMooshMode ? 'success' : 'info'}">${isMooshMode ? 'Moosh' : 'Original'}</span></li>
                    <li>Border Color: <span style="color: ${borderColor}">${borderColor}</span></li>
                    <li>Text Color: <span style="color: ${color}">${color}</span></li>
                    <li>SVG Arrow Color: <span style="color: ${svgColor}">${svgColor}</span></li>
                    <li>Expected Color: <span style="color: ${expectedColor}">${expectedColor}</span></li>
                    <li>Theme Aware: <span class="${borderColor.includes(expectedColor.substring(1)) ? 'success' : 'error'}">${borderColor.includes(expectedColor.substring(1)) ? 'YES' : 'NO'}</span></li>
                </ul>
            `;
            
            const selectorStatus = document.getElementById('selector-status');
            selectorStatus.textContent = `Currency Selector: ${stylesApplied ? 'Styled' : 'Not styled'} | Theme: ${isMooshMode ? 'Moosh' : 'Original'}`;
            selectorStatus.className = stylesApplied ? 'status success' : 'status error';
        }
        
        function updateStatus(message, type = 'info') {
            console.log(`[Test] ${message}`);
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${timestamp}] ${message}`;
            results.appendChild(entry);
            
            // Keep only last 10 entries
            while (results.children.length > 10) {
                results.removeChild(results.firstChild);
            }
        }
    </script>
</body>
</html>