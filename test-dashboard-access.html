<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard Access</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: monospace;
            padding: 20px;
        }
        .log {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #333;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #000;
            border: 2px solid #f57315;
            color: #f57315;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
        }
        button:hover {
            background: #f57315;
            color: #000;
        }
    </style>
</head>
<body>
    <h1>Dashboard Access Test</h1>
    
    <button onclick="testDirectAccess()">Test Direct Dashboard Access</button>
    <button onclick="testAccountsCreation()">Test Account Creation</button>
    <button onclick="clearLocalStorage()">Clear All Data</button>
    <button onclick="checkState()">Check Current State</button>
    
    <div class="log" id="log"></div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        function testDirectAccess() {
            addLog('Testing direct dashboard access...');
            
            // Set up basic state
            const testAccount = {
                id: 'test_account_' + Date.now(),
                name: 'Test Account',
                addresses: {
                    spark: 'sp1test...',
                    bitcoin: 'bc1test...'
                },
                createdAt: Date.now(),
                isImport: false,
                seedHash: 'test',
                balance: { spark: 0, bitcoin: 0, total: 0 }
            };
            
            // Save account data
            const accountData = {
                accounts: [testAccount],
                currentAccountId: testAccount.id,
                lastSaved: Date.now()
            };
            
            localStorage.setItem('mooshAccounts', JSON.stringify(accountData));
            localStorage.setItem('walletUnlocked', 'true');
            addLog('Test account created and saved');
            
            // Navigate to dashboard
            addLog('Navigating to dashboard...');
            window.location.href = '/index.html#dashboard';
        }
        
        function testAccountsCreation() {
            addLog('Creating test accounts...');
            
            const accounts = [];
            for (let i = 1; i <= 3; i++) {
                accounts.push({
                    id: `acc_${Date.now()}_${i}`,
                    name: `Account ${i}`,
                    addresses: {
                        spark: `sp1test${i}...`,
                        bitcoin: `bc1test${i}...`
                    },
                    createdAt: Date.now(),
                    isImport: i === 2, // Make second account imported
                    seedHash: `hash${i}`,
                    balance: { 
                        spark: Math.floor(Math.random() * 1000000), 
                        bitcoin: Math.floor(Math.random() * 100000), 
                        total: 0 
                    }
                });
            }
            
            const accountData = {
                accounts: accounts,
                currentAccountId: accounts[0].id,
                lastSaved: Date.now()
            };
            
            localStorage.setItem('mooshAccounts', JSON.stringify(accountData));
            localStorage.setItem('walletUnlocked', 'true');
            
            addLog(`Created ${accounts.length} test accounts`);
            accounts.forEach(acc => {
                addLog(`  - ${acc.name}: ${acc.addresses.spark.substring(0, 10)}...`);
            });
        }
        
        function clearLocalStorage() {
            addLog('Clearing all local storage...');
            const keys = ['mooshAccounts', 'walletUnlocked', 'walletPassword', 'sparkWallet', 'generatedSeed'];
            keys.forEach(key => {
                localStorage.removeItem(key);
                addLog(`  - Removed: ${key}`);
            });
            addLog('All data cleared');
        }
        
        function checkState() {
            addLog('Checking current state...');
            
            // Check accounts
            const accounts = localStorage.getItem('mooshAccounts');
            if (accounts) {
                try {
                    const data = JSON.parse(accounts);
                    addLog(`Accounts: ${data.accounts.length} found`);
                    data.accounts.forEach(acc => {
                        addLog(`  - ${acc.name} (${acc.id})`);
                    });
                    addLog(`Current account ID: ${data.currentAccountId}`);
                } catch (e) {
                    addLog(`Error parsing accounts: ${e.message}`);
                }
            } else {
                addLog('No accounts found');
            }
            
            // Check unlock status
            const unlocked = localStorage.getItem('walletUnlocked');
            addLog(`Wallet unlocked: ${unlocked || 'false'}`);
            
            // Check password
            const hasPassword = localStorage.getItem('walletPassword') !== null;
            addLog(`Password set: ${hasPassword}`);
            
            // Check generated seed
            const hasSeed = localStorage.getItem('generatedSeed') !== null;
            addLog(`Generated seed exists: ${hasSeed}`);
        }
        
        // Initial check
        addLog('Dashboard Access Test Ready');
        checkState();
    </script>
</body>
</html>